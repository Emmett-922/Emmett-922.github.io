<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.js"></script>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Effort Tracking</title>
        <link rel="stylesheet" href="css/efforttracking.css">
    </head>
    <body>
        <nav class="navBar">
            <h2 class="logo">ProManager</h2>
            <h2 class="bar">|</h2>
            <ul>
                <li>
                    <a href="index.html">Home</a>
                    <a href="project.html">Project Home</a>
                    <a href="requirements.html">Requirements</a>
                    <a href="projectedit.html">Edit Project</a>
                    <a href="efforttracking.html">Effort Tracking</a>
                </li>
            </ul>
        </nav>

        <br><br>

        <div class="pageHeader">
            <h1 class="pageTitle">Effort Tracking</h1>
            <br><br>
            <button class="enter_details" id="enter_details_button" onclick="go_to_effort_entering_page()">Enter Details</button>
        </div>

        <br><br><br>

        <div class="display_section">
            <h2>Effort Towards Functional Requirements (in Person-Hours)</h2>

            <input class="fReq_effort_display_option" name="fReq_effort_display_option" id="fReq_total_option" type="radio">&nbsp;&nbsp;Total Effort&nbsp;&nbsp;&nbsp;&nbsp;</input>
            <input class="fReq_effort_display_option" name="fReq_effort_display_option" id="fReq_average_daily_option" type="radio">&nbsp;&nbsp;Average Daily Effort&nbsp;&nbsp;&nbsp;&nbsp;</input>
            <input class="fReq_effort_display_option" name="fReq_effort_display_option" id="fReq_average_weekly_option" type="radio">&nbsp;&nbsp;Average Weekly Effort&nbsp;&nbsp;&nbsp;&nbsp;</input>


            <div class="reqCharts" id="fReqTotalEffortCharts" style="width:100%;max-width:700px">
                <script type="text/javascript">
                    var projID = localStorage.getItem("currentProject");
                    var projectList = JSON.parse(localStorage.getItem("projectList"));
                    var fReqList = [];
                    var fReqEffortTrackingEntries = [];
                    var fReqTotals = [];
                    const xVals = ["Req Analysis", "Designing", "Coding", "Testing", "Proj. Management"];
                    const barColors = ["orangered", "rgb(61, 61, 61)","orangered","rgb(61, 61, 61)","orangered"];
                    var yValues = [];
                    var hasEffortDetails = false;
                    
                    projectList.forEach(function(p){
                        if(projID == p.name) {
                            fReqList = p.functional_reqs;
                        }
                    });

                    for(let i = 0; i < fReqList.length; i++) {
                        if (fReqList[i].effortTrackingEntries == null) {
                            console.log('empty');
                        }
                        else {
                            fReqEffortTrackingEntries = fReqList[i].effortTrackingEntries;

                            const div = document.getElementById('fReqTotalEffortCharts');
                            const lineBreak = document.createElement('br');
                            var canvasID = "canvas-" + fReqList[i].id;

                            var canvas = document.createElement('canvas');
                            canvas.setAttribute('class', 'fReqChartCanvas');
                            canvas.setAttribute('id', canvasID);
                            canvas.setAttribute('style', 'width:100%;max-width:700px');
                            canvas.style.backgroundColor = "rgb(33, 33, 33)";

                            div.appendChild(lineBreak);
                            div.appendChild(canvas);

                        
                            var totalRA = 0, totalDes = 0, totalCo = 0, totalTes = 0, totalPM = 0;
                            var totalRA_d = '', totalDes_d = '', totalCo_d = '', totalTes_d = '', totalPM_d = '';
                            var totalRA_w = '', totalDes_w = '', totalCo_w = '', totalTes_w = '', totalPM_w = '';
                            var avgRA_d = '', avgDes_d = '', avgCo_d = '', avgTes_d = '', avgPM_d = '';
                            var avgRA_w = '', avgDes_w = '', avgCo_w = '', avgTes_w = '', avgPM_w = '';
                            var dailyCount, weeklyCount;

                            for(let j = 0; j < fReqEffortTrackingEntries.length; j++) {
                                totalRA += Number(fReqEffortTrackingEntries[j].reqAnalysisHours);
                                totalDes += Number(fReqEffortTrackingEntries[j].designingHours);
                                totalCo += Number(fReqEffortTrackingEntries[j].codingHours);
                                totalTes += Number(fReqEffortTrackingEntries[j].testingHours);
                                totalPM += Number(fReqEffortTrackingEntries[j].projManagementHours);
                            }   

                            yValues.push(totalRA); yValues.push(totalDes); yValues.push(totalCo);
                            yValues.push(totalTes); yValues.push(totalPM);

                            fReqTotals.push(yValues);
                        }
                    }

                    for (let i = 0; i < fReqList.length; i++) {
                        canvasID = "canvas-" + fReqList[i].id;

                        var data = {
                            labels: xVals,
                            datasets: [{
                                backgroundColor: barColors,
                                data: fReqTotals[i],
                            }]
                        };

                        var config = {
                            type: "bar",
                            data: data,
                            options: {
                                plugins: {
                                    title: {
                                        display: true,
                                        text: fReqList[i].value,
                                        color: "white",
                                        font: {
                                            size: 20
                                        }
                                    },
                                    legend: {
                                        display: false
                                    },
                                    scales: {
                                        y: {
                                            ticks: {
                                                color: "white"
                                            }
                                        }
                                    }
                                }
                            }
                        };

                        var chart = new Chart(
                            document.getElementById(canvasID),
                            config
                        )
                    }

                    
                    document.getElementById("fReq_average_daily_option").onclick = function(){
                        yValues.push(avgRA_d); yValues.push(avgDes_d); yValues.push(avgCo_d);
                        yValues.push(avgTes_d); yValues.push(avgPM_d);
                        if(fReqEffortTrackingEntries[i].timeBasis == "daily"){
                            dailyCount++;
                            totalRA_d += fReqEffortTrackingEntries[i].reqAnalysisHours;
                            totalDes_d += fReqEffortTrackingEntries[i].designingHours;
                            totalCo_d += fReqEffortTrackingEntries[i].codingHours;
                            totalTes_d += fReqEffortTrackingEntries[i].testingHours;
                            totalPM_d += fReqEffortTrackingEntries[i].projManagementHours;
                        }
                    }
                    document.getElementById("fReq_average_weekly_option").onclick = function(){
                        yValues.push(avgRA_w); yValues.push(avgDes_w); yValues.push(avgCo_w);
                        yValues.push(avgTes_w); yValues.push(avgPM_w);

                        if(fReqEffortTrackingEntries[i].timeBasis == "weekly") {
                            weeklyCount++;
                            totalRA_w += fReqEffortTrackingEntries[i].reqAnalysisHours;
                            totalDes_w += fReqEffortTrackingEntries[i].designingHours;
                            totalCo_w += fReqEffortTrackingEntries[i].codingHours;
                            totalTes_w += fReqEffortTrackingEntries[i].testingHours;
                            totalPM_w += fReqEffortTrackingEntries[i].projManagementHours;
                        }
                    }

                </script>
            </div>

            <br><br><br>

            <h2>Effort Towards Non-Functional Requirements (in Person-Hours)</h2>

            <input class="nfReq_effort_display_option" name="nfReq_effort_display_option" id="nfReq_total_option" type="radio" checked>&nbsp;&nbsp;Total Effort&nbsp;&nbsp;&nbsp;&nbsp;</input>
            <input class="nfReq_effort_display_option" name="nfReq_effort_display_option" id="nfReq_average_daily_option" type="radio">&nbsp;&nbsp;Average Daily Effort&nbsp;&nbsp;&nbsp;&nbsp;</input>
            <input class="nfReq_effort_display_option" name="nfReq_effort_display_option" id="nfReq_average_weekly_option" type="radio">&nbsp;&nbsp;Average Weekly Effort&nbsp;&nbsp;&nbsp;&nbsp;</input>

            <div class="reqCharts" id="nfReqCharts">
                <script type="text/javascript">

                </script>
            </div>
        </div>
    </body>
</html>

<script type="text/javascript">
    function go_to_effort_entering_page(){
        location.href = "efforttrackingdetails.html";
    }
</script>